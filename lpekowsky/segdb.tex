
\subsection{Data Quality Flags}

The state of the instrument at any time is summarized by a set of
\emph{flags}.  Flags are identified by a triple of (ifo id, flag name,
version number), where \emph{ifo id} identifies the instrument,
\emph{flag name} is a unique identifier, and \emph{version number} is
an integer starting from 1.  The version number allows information to
be updated without losing information that may be needed to
reconstruct the results of earlier searches.  The full set of flags is
stored in a database designed at Syracuse and hosted at Caltech.

Flags are stored as a set of \emph{segments}, half-open intervals
aligned on GPS integer second boundaries.  Each flag triple has an
associated set of segments indicating the times during which it is
\emph{defined}.  Such triples also have a set of segments indicating
times during which they are \emph{active}.  The set of active segments
must be a subset of defined segments.  Times during which a flag is
defined and not active are considered \emph{inactive}.

Flags may be entered manually through a web interface.  This can be
used to indicate nonstandard operating conditions, such as heavy
equipment being operated on site.  However, most flags are generated
automatically.

The first line of defense against noise triggers is on-site as the
instrument is running.  At all such times the control room is staffed
by an operator who is an expert in running the instrument employed by
LIGO labs, and a science monitor (``SciMon'') who is a member of the
LIGO Scientific Collaboration.  The two jointly decide when to enable
\emph{science mode}, which marks the data as suitable for analysis.
This declaration is not specific to the CBC group, but extends to all
searches in the collaboration.  Science time is indicated by the flag
\texttt{DMT\_SCIENCE}.

In addition to the readout channel (\texttt{DARM\_ERR}, section
\ref{sec:ligo_detectors}) many other data channels are recorded,
falling into two broad categories.  Physical environmental monitor
(``PEM'') channels record information about the environment such as
seismic activity at the base and end stations, microphones and
magnetometers placed throughout the site, etc.  Instrumental
(``INST'') channels record data from numerous subsystems such as
servos for each mirror and the output of photodiodes at points
throughout the light path.  Software running at the sites called the
data monitoring tool (``DMT'') creates data quality flags based on
these channels.  For example, when a channel's value or standard
deviation over time exceeds a given threshold.  The DMT is also
responsible for recording the state of the science mode flag.  Other
flags are set by programs that run analyses on these auxiliary
channels, for examples see~\cite{Isogai:2010}.


\subsection{The Veto Definer}

Problems in the data may have differing levels of severity, and
consequently we define several \emph{veto categories} to characterize
them.  The categories used by daily ihope differ slightly from those
used by the full analysis.

Category 1 vetoes indicates time that should not have been marked as
science mode.  Typically attempting to analyze this time will
adversely affect the entire 2048-second analysis chunk, for example by
biasing the PSD (section \ref{sec:ihope_psd}).  Note that it is
possible to correct science time by creating a new version of the
\texttt{DMT\_SCIENCE} flag with an incremental version number.
However, doing so is a more complicated process than creating a veto
flag, and removing time by denoting it CAT1 carries additional
information about the reason for the veto.  Note that category 1
vetoes are undesirable, as they may remove time outside the range of
the problem.  For example, a 4080-second span of science-mode data
with a one-second CAT1 veto at 2040 seconds will be completely
unanalyzable by the CBC group, as excising the bad data will leave no
contiguous 2048-second block.

Category 2 vetoes indicates time during which there was a problem,
instrumental or environmental, with well-understood coupling into
\texttt{DARM\_ERR}.  Such time can be analyzed without problem, but
triggers from such time will be discarded. 

Category 3 vetoes remove hardware injections (section
\ref{sec:ihope_hardware_injections}).  In the full analysis hardware
injection vetoes do not have a category number and is denoted
``hardware injections removed.''

Category 4 is for time that appears to be ill-behaved according to 
data quality studies, but where there is no clearly-understood 
cause.  In the full analysis this is denoted category 3.

Finally, a map is needed between data quality flags and veto
categories.  This is achieved through the use of a search-specific
\emph{veto definer file} which associates a flag with a veto level.
Intervals within the range during which that version of the flag are
active will be marked with the corresponding veto level.  The
\texttt{ligolw\_segments\_from\_cats} program (see below) merges the
information in this file with the set of active flag segments to produce
\emph{veto segments} at each veto level.  Analysis is performed on
times marked as science with no CAT1 vetoes.  Triggers from times
marked as CAT2, CAT3 and CAT4 are discarded from both foreground and
background.

Sometimes the threshold on a DQ flag is such that the data is
unsuitable for analysis close to, but outside, the range of the flag.
The veto definer file therefore allows for \emph{padding}, offsets 
which effectively extend the flags.

\iffalse
\subsection{Technical details}

The flag segments are stored in a high-performance relational
database, exposed as a web service which provides secure access to all
members of the collaboration.  Several utilities to interact with the
segment database were written, many of which could run in many modes.
The names of all these utilities start with ligolw, short for ``LIGO
lightweight,'' an XML-based format used throughout the collaboration
in which the output was generated.

Except where noted all programs accept a common subset of arguments
\begin{itemize}
\item \texttt{--gps-start-time} and \texttt{--gps-end-time}: Integer
GPS times specifying the time range over which to run.
\item \texttt{--include-segments}: Takes a comma-separated list of
segment specifiers of the form ifo:flag\_name:version or
ifo:flag\_name and restricts the query to matching flags.  In the
latter case, report on the latest version of the flag defined at each
time within the time range.
\item \texttt{--exclude-segments}: Takes a comma-separated list of
segment specifiers in the same format as \texttt{--include-segments}.
Runs a second query on the excluded segments and returns the set of
segments in included segments - (included segments $\cap$ excluded
segments).
\item \texttt{--database}, \texttt{--segment-url},
\texttt{--dmt-files}: Specifies the data source (segment database or
XML files with segment information).
\end{itemize}


The programs used during S6 were:

\textbf{ligolw\_dq\_query}.  This program reports on the state of
flags at one or more GPS times given on the command line.  This
program does not support \\
\texttt{--gps-start-time} or \texttt{--gps-end-time}.   The available modes are

\begin{itemize}
\item \texttt{--report}:  Returns the active/inactive status of all DQ flags at the
given times.  For active flags reports the start and end times of the
segment within which the given time is contained.  For inactive flags
reports the end time of the nearest preceding segment and the start
time of the nearest subsequent segment.  This mode is used in the
daily ihope ``loudest glitches'' page, see below.
\item \texttt{--defined}: Returns a list of flags defined at the
given times.
\item \texttt{--active}: Returns a list of the flags that were active
at the given times.
\item \texttt{--start-pad}, \texttt{--end-pad}: Extends the
\texttt{--defined} and \texttt{--active} modes to report on the status
of flags within a small range of time.
\end{itemize}


\textbf{ligolw\_segment\_query}.  This program reports on the state of a
set of flags over a span of times.  The available modes are

\begin{itemize}
\item \texttt{--show-types}: Reports the sets of flags that exist over
the time span.
\item \texttt{--query-types}: Reports the segments during which the
flags were defined.
\item \texttt{--query-segments}: Reports the segments during which the
flags were active.
\end{itemize}

Every CBC analysis begins by determining the science mode times with a
call of the form

\vspace*{5mm}
\texttt{ligolw\_segment\_query} \\
\hspace*{0.5in}\texttt{--query-segments --include-segments H1:DMT-SCIENCE:3 ...}
\vspace*{5mm}

\textbf{ligolw\_segments\_from\_cats}.  Given a veto definer file,
report on segments to be vetoed. 

\textbf{ligolw\_dq\_active\_cats}.  Given a veto definer file and GPS
time, report on the active/inactive status and veto category for all
flags defined at the time.

\textbf{ligolw\_segment\_insert}.  Adds new segments to the database,
enforcing various policy decisions:
\begin{itemize}
\item New segments for an existing flag/version number pair must not overlap 
with existing segments.  To update information a new version number must be used.
\item New version numbers must be one greater than the largest
existing version number.
\item New segments must not extend into the future, past the GPS time
at which the program is run.
\end{itemize}
\fi

% https://www.lsc-group.phys.uwm.edu/daswg/wiki/content_of_segment_publication_and_discovery

\Note{The following was taken from T0900005 -- Needs to be cleaned up
and integrated!}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

This document describes the infrastructure used to manage data quality
and veto information in the LIGO S6 Science Run. Data quality
information is generated by a combination of automated Data Monitoring
Tool (DMT) software and scientist investigation. This information must
be stored for archiving and retrieval. A suite of tools should be
provided for users to update and query the stored data. In S6, the
segment database is the central location all DQ data is written in to. 

Two parallel solutions are being pursued:
\begin{enumerate}
\item A database-based solution will allow users to store and query segment
information. This will be based on the infrastrure used in S5, updated with
the lessons learned from the science run.
\item Tools will be provided to allow users/programs to query the online DQ
data files generated by the DMT. This will allow users to perform small
low-latency queries relevant to online searches in the most direct manner
possible.
\end{enumerate}

\section{Implementation plan}
\begin{figure}[h]
  \begin{center}
    \includegraphics[width=0.9\linewidth]{figures/segdb/T0900005_fig1}
  \end{center}
  \caption{Data flow for S6 data quality segment information. Online data
  quality segments and science segment information is generated by the DMT.
  This can be directly queried for low-latency online analysis or inserted
  into a segment database for off-line or higher-latency analyses. Command
  line and web GUI  tools can be used to query and update the segment
  database.} 
\end{figure}

\begin{enumerate}
\item \textbf{DMT trigger manager:} The DMT trigger manager will handle the
creation of all science segments and online data quality segments in S6. Every
60 seconds, the DMT trigger manager writes segment information in XML format
to disk at the Observatories. The DMT calls the \verb|dmtdq_seg_insert|
program to insert the XML data into the segment database.

To prevent confusion with cases sensitivity in processing tools, all DQ flag
names must be in upper case case. Additionally, a 3-letter prefix will be
added to each DQ flag to better identify the source where data comes from. For
example: the S5 DQ flag known as \verb|Wind_Over_30MPH| should be writted
into the XML file as \verb|DMT-WIND_OVER_30MPH| in S6. All DQ flags generated online by the DMT should have version
number 1.

\item \textbf{Archival of DMT segment data:} The 60 second XML files generated
by the DMT will be archived every 3600 seconds onto the LDAS
\verb|/archive/dataprods| filesystem for replication to Caltech and Teir 2
computing centers. Files will be compressed using the gzip algorithm.

\item \textbf Software will be developed to take the XML files from DMT disk
and together with a data quality categorization file managed by the search
groups (e.g. H1-ONLINEALLSKYBURSTCATS-815155200-63072000.xml) will produce XML
files containing the segments for a given DQ category for a given search once
per minute or so. In addition ligolw\_print can be used to convert these XML
files to ASCII format for search groups that want ASCII segment lists. The same
software will be made available for interfacing with the segment database for
offline searches and detector characterization. 

\item \textbf{Expected Latencies:} as described in the implementation plan
diagram, expected latencies are:
\begin{itemize}
\item DMT generates h(t) file: 60 seconds
\item From DMT to raw DMT segment disk: 60 seconds
\item From raw DMT segment disk to segment database: 10 seconds
\item From ligolw\_segment\_insert to segment database: 30 seconds
\end{itemize}
\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{S6 segment database design}

The S6 segment database schema (and hence the XML files) have been
substantially simplified for S6.  The five tables to be used for S6 are shown
in figure~\ref{f:schema}. All uncessary tables have been eliminated and the
remaining table set simplified. The \verb|process|, \verb|process_params| and
\verb|segment_definer| tables are unchanges from S5, with the exception that
the \verb|domain| column in the \verb|process| table is used to store the
distingished name of the user inserting the data.  In S5, segments were either
stored as on or off allowing users to distinguish between a segment being off
or undefined, due to data not being analyzed. It was foung that the
off/undefined query was used substantially less than the on query, and so in
S6 this column is eliminated from the \verb|segment| table.  To ensure that
off/undefined information is still available, the a \verb|segment_summary| is
introduced in S6 to store time intervals when quality flags are defined. This
further simplified the query ``What versions were defined at what time?''
allowing better use of version information in S6.

\begin{figure}[h]
  \begin{center}
    \includegraphics[width=0.9\linewidth]{figures/segdb/T0900005_fig3}
  \end{center}
  \label{f:schema}
  \caption{S6 Segment Database Schema}
\end{figure}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Data Replication Between Observatories and Tier 2 Centers}

In S6, Caltech segment database is the official data repository. In
addition to being written into the database, all data inserted in to
the Caltech segment database will be output as xml files to a central
location. These xml files will then be replicated to tier 2 sites at
ldas.ligo-wa.caltech.edu, ldas.ligo-la.caltech.edu. A rsync script
will be implemented at Caltech to periodically replicate xml files
from Caltech to tier 2 sites. At the sites, a publishing script will
be implemented to publish the xml files to the local segment database.

In addition to database replication, the archived DMT segment files will be
replicated between sites using rsync, according to the DASWG
\verb|/archive/dataprods| prototcol.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{User Interface}

\subsection{GUI Segment Query Tools}

In S6, we will no longer support plain ASCII dumps of the segment database.
Use of segwizard will be depricated in favor of a web-based GUI, similar to
the web GUI used by the Virgo segment database.  Users will be able to
manipulate graphical tools in the web browser interface to retrieve desired
results directly from the segment database. 

A GUI will also be provided for the DetChar chair (and designated people) to
modify segment information stored in the database.

\subsection{Command Line Tools}

\subsubsection{ligolw\_segment\_query}

The glue program \verb|ligolw_segment_query| replaces LSCsegFind as the
command line interface to query for data quality and science segments.
\verb|ligolw_segment_query| can query either the segment database or
directories containing XML segment files generated by the DMT.
\verb|ligolw_segment_query| only provides read access to the segment database.
\verb|ligolw_segment_query| primarily intended for human interaction with the
segment database. Automated generation of DQ files for online searches should
use the program \verb|ligolw\_veto\_segments|.

Below are the questions that ligolw\_segment\_query can answer:
\begin{itemize}
\item What DQ flags exist in the database? ligolw\_segment\_query --show-types
\item When was a given flag inserted? ligolw\_segment\_query --query-types
\item When was a given DQ flag deÔ¨Åned? ligolw\_segment\_query --query-types
\item When was a given flag active? ligolw\_segment\_query --query-segments 
\end{itemize}


DESCRIPTION:
{\small
\begin{verbatim}
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -p, --ping            Ping the target server
  -y, --show-types      Returns a xml table containing segment type
                        information: ifos, name, version,
                        segment_definer.comment, segment_summary.start_time,
                        segment_summary.end_time, segment_summary.comment
  -u, --query-types     Returns a ligolw document whose segment_definer table
                        includes all segment types defined in the given period
                        and included by include-segments and whose
                        segment_summary table indicates the times for which
                        those segments are defined.
  -q, --query-segments  Returns a ligolw document whose segment table contains
                        the times included by the include-segments flag and
                        excluded by exclude-segments
  -s gps_start_time, --gps-start-time=gps_start_time
                        Start of GPS time range
  -e gps_end_time, --gps-end-time=gps_end_time
                        End of GPS time range
  -t segment_url, --segment-url=segment_url
                        Segment URL. Users have to specify either 'https://'
                        for a secure connection or 'http://' for an insecure
                        connection in the segment database url. For example,
                        '--segment-url=https://segdb.ligo.caltech.edu'. No
                        need to specify port number.
  -d, --database        use database specified by environment variable
                        S6_SEGMENT_SERVER. For example,
                        'S6_SEGMENT_SERVER=https://segdb.ligo.caltech.edu'
  -f, --dmt-files       use files in directory specified by environment
                        variable ONLINEDQ, for example,
                        'ONLINEDQ=file:///path_to_dmt'. 'file://' is the
                        prefix, the acutal directory to DMT xml files starts
                        with '/'.
  -a include_segments, --include-segments=include_segments
                        This option expects a comma separated list of a colon
                        separated sublist of interferometer, segment type, and
                        version. The union of segments from all types and
                        versions specified is returned. Use --show-types to
                        see what types are available.   For example:
                        --include-segment-types H1:DMT-SCIENCE:1,H1:DMT-
                        INJECTION:2 will return the segments for which H1 is
                        in either SCIENCE version 1 or INJECTION version 2
                        mode. If version information is not provided, the
                        union of the segments of the latest version of
                        requested segment type(s) will be returned.
  -b exclude_segments, --exclude-segments=exclude_segments
                        This option has to be used in conjunction with
                        --include-segment-types --exclude-segment-types
                        subtracts the union of unwanted segments from the
                        specified types from the results of --include-segment-
                        types. If version information is not provided,
                        --exclude-segment-types subtracts the union of
                        segments from the latest version of the specified
                        segment types. For example, --include-segment-types H1
                        :DMT-SCIENCE:1,H1:DMT-INJECTION:2 --exclude-segment-
                        types H1:DMT-WIND:1,H1:DMT-NOT_LOCKED:2,H2:DMT-
                        NOT_LOCKED:2 will subtract the union of segments which
                        H1 is in version 1 WIND and H1,H2 is version 2
                        NOT_LOCKED from the result of --include-segment-types
                        H1:DMT-SCIENCE:1,H1:DMT-INJECTION:2
  -S, --strict-off      The default behavior is to truncate segments so that
                        returned segments are entirely in the interval [gps-
                        start-time, gps-end-time).  However if this option is
                        given, the entire non-truncated segment is returned if
                        any part of it overlaps the interval.
  -o output_file, --output-file=output_file
                        File to which output should be written.  Defaults to
                        stdout.
\end{verbatim}
}

\subsubsection{ligolw\_dq\_query}
ligolw\_dq\_query can query either the segment database or directories containing XML segment files generated by the DMT. ligolw\_dq\_query only provides read access to the segment database. 

Below are the questions that ligolw\_dq\_query can answer:
\begin{itemize}
\item is a given flag active at a given time? ligolw\_dq\_query --active
\item is a given flag defined at a given time? ligolw\_dq\_query --defined
\item what is the status of all flags at a given time? ligolw\_dq\_query --report
\end{itemize}


DESCRIPTION:
{\small
\begin{verbatim}
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -p, --ping            Ping the target server
  -y, --defined         Returns a segment summary table containing segments
                        defined at the given time(s).
  -u, --active          Returns a segment table containing segments active at
                        the given time(s).
  -q, --report          Prints which flags are defined/undefined at the given
                        time(s). For the flags which were defined, it
                        determines if the flag was active or inactive at that
                        time. For an active flag, it prints the start and end
                        time of the segment to which the active. For an
                        inactive flag, it prints the end time of the previous
                        adjacent active segment and the start time of the next
                        adjacent active segment
  -s start_pad, --start-pad=start_pad
                        Seconds before given time(s) to include in query
  -e end_pad, --end-pad=end_pad
                        Seconds after given time(s) to include in query
  -t segment_url, --segment-url=segment_url
                        Segment URL
  -d, --database        use database specified by environment variable
                        S6_SEGMENT_SERVER
  -f, --dmt-files       use files in directory specified by environment
                        variable ONLINEDQ
  -a include_segments, --include-segments=include_segments
                        This option expects a comma separated list of a colon
                        separated sublist of interferometer, segment type, and
                        version. The union of segments from all types and
                        versions specified is returned. Use --show-types to
                        see what types are available.   For example:
                        --include-segment-types H1:SCIENCE:1,H1:INJECTION:2
                        will return the segments for which H1 is in either
                        SCIENCE version 1 or INJECTION version 2 mode. If
                        version information is not provided, the union of the
                        segments of the latest version of requested segment
                        type(s) will be returned.
  -o output_file, --output-file=output_file
                        File to which output should be written.  Defaults to
                        stdout.
  -i, --in-segments-only
                        If set, report will only return segments that given
                        times were within
\end{verbatim}
}



\subsubsection{ligolw\_segments\_from\_cats}
ligolw\_segments\_from\_cats reads one or more segment files and a veto file and generates files of veto segments.

DESCRIPTION:
\begin{verbatim}
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -v veto_file, --veto-file=veto_file
                        veto XML file (required).
  -o output_dir, --output-dir=output_dir
                        Directory to write output (default=cwd).
  -k, --keep-db         Keep sqlite database.
  -t segment_url, --segment-url=segment_url
                        Segment URL
  -d, --database        use database specified by environment variable
                        S6_SEGMENT_SERVER
  -f, --dmt-file        use files in directory specified by environment
                        variable ONLINEDQ
  -c, --cumulative-categories
                        If set the category N files will contain all segments
                        in categories <= N
  -p, --separate-categories
                        If set the category N files will contain only category
                        N
  -s gps_start_time, --gps-start-time=gps_start_time
                        Start of GPS time range
  -e gps_end_time, --gps-end-time=gps_end_time
                        End of GPS time range
\end{verbatim}


For example:
\begin{verbatim}
ligolw\_segments\_from\_cats --gps-start-time 930960015 --gps-end-time 931564887 --segment-url https://segdb.ligo.caltech.edu:30015 --cumulative-categories --veto-file http://www.lsc-group.phys.uwm.edu/ligovirgo/cbc/public/segments/S6/H1L1V1-S6\_CBC\_LOWMASS\_ONLINE-928271454-0.xml
\end{verbatim}




\subsubsection{ligolw\_segment\_insert}
ligolw\_segment\_insert is the replacement of LSCdqInsert. ligolw\_segment\_insert handles two tasks:
\begin{itemize}
\item Insert segments and/or segment types into the segment database.
\item Append segments to the existing segment types.
\end{itemize}
ligolw\_segment\_insert follows the underlying methods of LSCdqInsert to insert segments, but there are several changes made in ligolw\_segment\_insert which includes:
\begin{itemize}
\item - -interval option is removed. In LSCdqInert, - -interval is used to read in a single segment. With ligolw\_segment\_insert, user has to specify a plain text file containing the segment(s), even if there is only one segment in the text file.
\item - -run option is removed.
\item Users have to provide segment file which contains the active segments of a given segment type of the whole run and summary file which contains the validity intervals of this given segment type of the whole run which activ segments belong.
\end{itemize}

DESCRIPTION:
\begin{verbatim}
  -h, --help            show this help message and exit
  -p, --ping            Ping the target server
  -t URL, --segment-url=URL
                        Users have to specify protocol 'https://' for a secure
                        connection in the segment database url. For example,
                        '--segment-url=https://segdb.ligo.caltech.edu'. No
                        need to specify port number'.
  -o FILE, --output=FILE
                        Write segments to FILE rather than the segment
                        database
  -j IDENTITY, --identity=IDENTITY
                        Set the subject line of the server's service
                        certificate to IDENTITY
  -I, --insert          Insert segments to the segment database
  -A, --append          Append segments to an existing segment type
  -i IFOS, --ifos=IFOS  Set the segment interferometer to IFOS (e.g. H1)
  -n NAME, --name=NAME  Set the name of the segment to NAME (e.g. DMT-
                        BADMONTH)
  -v VERSION, --version=VERSION
                        Set the numeric version of the segment to VERSION
                        (e.g. 1)
  -e EXPLAIN, --explain=EXPLAIN
                        Set the segment_definer:comment to COMMENT. This
                        should explaining WHAT this flag mean (e.g. "Light dip
                        10%"). Required when --Insert/-I is specified.
  -c COMMENT, --comment=COMMENT
                        Set the segment_summary:comment to COMMENT. This
                        should explaining WHY these segments were inserted
                        (e.g. "Created from hveto results")
  -S FILE, --summary-file=FILE
                        Read the segment_summary rows from FILE. This should
                        be a file containing the gps start and end times that
                        the flag was defined, deliminated by comma (i.e. the union of on and off)
  -G FILE, --segment-file=FILE
                        Read the segment rows from FILE. This should containin
                        the gps start and end times when the flag was active deliminated by comma
\end{verbatim}

To insert segments of new segment type, the command would look like:
\begin{verbatim}
ligolw\_segment\_insert --segment-url https://segdb.ligo.caltech.edu --ifos 'H1' --name 'DCH-TEST' --version 1 --comment 'testing if insert works' --explain 'test insert' --segment-file segment.txt --summary-file summary.txt --insert
\end{verbatim}

To append segments to an existing segment, the command would look like:
\begin{verbatim}
ligolw\_segment\_insert --segment-url https://segdb.ligo.caltech.edu --ifos 'H1' --name 'DCH-TEST' --version 1 --comment 'testing if append works' --segment-file append_segment.txt --summary-file append_summary.txt --append
\end{verbatim}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Functionality Supported in S6}
With the above described web browser and command line user interface, users will be able to find out:
\begin{itemize}
\item When was a given flag defined?
\item Was a given flag defined at this time?
\item When was a given flag active?
\item What is the dead time for a given flag? 
\item At a given point of time, is the given flag active? If yes, find out the start and end time of the segment to which the specified point of time belongs.
\item At a given point of time, is the given flag active? If no, find out the end time of the previous adjacent active segment and the start time of the next adjacent active segment.
\item Provide the same supports described above for a set of flags.
\item What flags were active at this time, near this time ($\pm 1$~s interval or specified by user)?
\item What is the efficiency for a flag for burst and inspiral and plot it.
\item Export answer to ascii or xml file
\item Handle padding windows for deadtime queries
\item Export config files, start, end times
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Authentication}
In S6, data insertion requires authentication. Retrieving from on-site requires no authentication. Retrieving from off-site requires authentication. 

\section{Exchange of data with Virgo}

\section{Example Veto Configuration File}

The veto configuration file should contain a \verb|process| table describing
how it was created and a \verb|veto_definer| table describing the flags to be
applied at different levels. The comment column of the process table should
contain the version of the file. The columns in the \verb|veto_definer| table
are as follows: \verb|ifo|, \verb|name| and \verb|version| uniquely define a
particular DQ/veto flag. \verb|category| described which veto category it
should be applied at (i.e. $0, 1, 2, 3, \ldots$), \verb|start_time| and
\verb|end_time| denote the GPS time interval for which the DQ/veto flag should
be applied (Note: if \verb|end_time| is zero, then the current GPS time is
assumed). \verb|start_pad| and \verb|end_pad| are the padding time (in
seconds) applied to the start and end of the veto segments. Note that these
are signed: if you want time vetoed to start time to be \emph{earlier} than
the start time listed in the database, then the emph \verb|start_pad| should
be \emph{negative}. Similarly, if the time vetoed should extend \emph{after}
the end time stored in the database, then the value in \verb|end_pad| should
be \emph{positive}. The \verb|comment| column can be used to store an optional
human-readable comment.

{\tiny
\begin{verbatim}
<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE LIGO_LW SYSTEM "http://ldas-sw.ligo.caltech.edu/doc/ligolwAPI/html/ligolw_dtd.txt">
<LIGO_LW>
   <Table Name="process:table">
      <Column Name="process:process_id" Type="ilwd:char"/>
      <Column Name="process:program" Type="lstring"/>
      <Column Name="process:version" Type="lstring"/>
      <Column Name="process:cvs_repository" Type="lstring"/>
      <Column Name="process:cvs_entry_time" Type="int_4s"/>
      <Column Name="process:node" Type="lstring"/>
      <Column Name="process:username" Type="lstring"/>
      <Column Name="process:unix_procid" Type="int_4s"/>
      <Column Name="process:start_time" Type="int_4s"/>
      <Column Name="process:end_time" Type="int_4s"/>
      <Column Name="process:ifos" Type="lstring"/>
      <Column Name="process:comment" Type="lstring"/>
      <Stream Name="process:table" Type="Local" Delimiter=",">
      "process:process_id:0","ligolw_veto_file","1.1",
      "/usr/local/cvs/lscsoft/glue/bin/ligolw_veto_file,v",822908378,
      "ldas-grid.ligo.caltech.edu","jrsmith",16830,822879594,822879594,
      "H1","Example file by Josh"
      </Stream>
   </Table>
   <Table Name="veto_definer:table">
      <Column Name="veto_definer:process_id" Type="ilwd:char"/>
      <Column Name="veto_definer:ifo" Type="lstring"/>
      <Column Name="veto_definer:name" Type="lstring"/>
      <Column Name="veto_definer:version" Type="int_4s"/>
      <Column Name="veto_definer:category" Type="int_4s"/>
      <Column Name="veto_definer:start_time" Type="int_4s"/>
      <Column Name="veto_definer:end_time" Type="int_4s"/>
      <Column Name="veto_definer:start_pad" Type="int_4s"/>
      <Column Name="veto_definer:end_pad" Type="int_4s"/>
      <Column Name="veto_definer:comment" Type="lstring"/>
      <Stream Name="veto_definer:table" Type="Local" Delimiter=",">
      "process:process_id:0","H1","OUT_OF_LOCK",0,1,917985615,0,0,0,"",
      "process:process_id:0","H1","BADGAMMA",1,1,917985615,0,0,0,"",
      "process:process_id:0","H1","ASC_Overflow",0,2,917985615,0,-8,8,"ASC saturations are cat2",
      "process:process_id:0","H1","PD_Overflow",0,2,917985615,0,-8,8,"PD saturations are cat2",
      "process:process_id:0","H1","SEVERE_LSC_OVERFLOW",0,2,917985615,0,-8,8,"LSC saturations are cat2",
      "process:process_id:0","H1","INJECTION",1,2,917985615,0,-16,64,"Remove HW injections at cat1",
      "process:process_id:0","H1","ASC_Overflow",0,3,917985615,0,-8,25,"ASC saturations are cat3 with larger pad",
      "process:process_id:0","H1","SEVERE_LSC_OVERFLOW",0,3,917985615,0,-8,25,"LSC saturations are cat3 with larger pad",
      "process:process_id:0","H1","PD_Overflow",0,3,917985615,0,-8,25,"PD saturations are cat3 with larger pad",
      "process:process_id:0","H1","Wind_over_30MPH",0,3,917985615,0,-8,8,"Windy",
      "process:process_id:0","H1","LIGHTDIP_1_PERCENT",0,3,917985615,0,-2,2,"Exclude all lightdip segments",
      "process:process_id:0","H1","PRE_LOCKLOSS_10_SEC",0,3,917985615,0,0,0,"",
      "process:process_id:0","H1","PRE_LOCKLOSS_30_SEC",0,3,917985615,0,0,0,"",
      "process:process_id:0","H1","PRE_LOCKLOSS_60_SEC",0,3,917985615,0,0,0,"",
      "process:process_id:0","H1","PRE_LOCKLOSS_120_SEC",0,3,917985615,0,0,0,"",
      "process:process_id:0","H1","ASI_CORR_OVERFLOW",0,4,917985615,0,-8,25,"Does this make sense for DC readout",
      "process:process_id:0","H1","LSC_OVERFLOW",0,4,917985615,0,-8,25,"LSC saturations",
      "process:process_id:0","H1","PRE_LOCKLOSS_600_SEC",0,4,917985615,0,0,0,"",
      "process:process_id:0","H1","PRE_LOCKLOSS_1800_SEC",0,4,917985615,0,0,0,""
      </Stream>
   </Table>
</LIGO_LW>
\end{verbatim}
}

\section{Segment Data File}

To be ingested into the segment database, segment data to be must be in the
format described in this section. Data should be in a valid LIGO LW XML file
with \verb|process|, \verb|segment_definer|, \verb|segment_summary| and
\verb|segment| tables. An optional \verb|process_params| table can be used to
store extra metadata about segment generation.

The \verb|process| table should contain the columns given in the XML file
below which describe the name, version, cvs repository and revision of the
program used generate the data. The comment column can be used to add
additional human-readable data. The node, username, unix\_procid, start\_time
and end\_time columns should store metadata describing who ran the process and
where it ran. The ifos column should contain an alphabetical list of all ifo
data using as input to the process. The process\_id column is used to link the
defined process to other rows in the file created by that process.

The \verb|segment_definer| table should contain a definition of the segments
included in the file. The ifos, name and version column should contain the
name and version of the segment. The name should be upper case for all
segments. DMT-derived segments should be prefixed with the string \verb|DMT-|,
KleineWelle derived veto segments should be prefixed with the string
\verb|KWV-|, data derived from the detector state vector channels should be
prefixed with \verb|IFO-|, segments created by the detchar group should be
prefixes with \verb|DCH-| and segments from the Virgo database should be
prefixed with \verb|VDB-|.  The comment column can be used to add a
human-readable description of the segment. The segment\_definer columm is used
to link this type of segment to the intervals in the \verb|segment| and
\verb|segment_summary| tables.

The \verb|segment| table should contain the GPS start and end time when the
segment described in the \verb|segment_definer| table was \emph{active}. The 
\verb|segment_summary| table should contain the GPS start time and end time of
the interval for which the segment is \emph{defined}. This will allow users to
distinguish between the cases where a DQ segment is undefined for a particular
time or simply inactive (i.e. it is \emph{not} windy, as opposed to the wind
monitor being down).

{\tiny
\begin{verbatim}
<?xml version="1.0"?>
<!DOCTYPE LIGO_LW SYSTEM "http://ldas-sw.ligo.caltech.edu/doc/ligolwAPI/html/ligolw_dtd.txt">
<LIGO_LW>
  <Table Name="processgroup:process:table">
    <Column Name="processgroup:process:program" Type="lstring"/>
    <Column Name="processgroup:process:version" Type="lstring"/>
    <Column Name="processgroup:process:cvs_repository" Type="lstring"/>
    <Column Name="processgroup:process:cvs_entry_time" Type="int_4s"/>
    <Column Name="processgroup:process:comment" Type="lstring"/>
    <Column Name="processgroup:process:node" Type="lstring"/>
    <Column Name="processgroup:process:username" Type="lstring"/>
    <Column Name="processgroup:process:unix_procid" Type="int_4s"/>
    <Column Name="processgroup:process:start_time" Type="int_4s"/>
    <Column Name="processgroup:process:end_time" Type="int_4s"/>
    <Column Name="processgroup:process:process_id" Type="ilwd:char"/>
    <Column Name="processgroup:process:ifos" Type="lstring"/>
    <Stream Name="processgroup:process:table" Type="Local" Delimiter=",">
      "SegGener","1.17",
      "/ldcg_server/common/repository_gds/gds/Monitors/SegGener/SegGener.cc\,v",
      865755895,"Segment generation from an OSC condition","granite","jzweizig",718,
      918756928,918836992,"process:process_id:0","H0H1H2"
    </Stream>
  </Table>
  <Table Name="segment_definergroup:segment_definer:table">
    <Column Name="segment_definergroup:segment_definer:process_id" Type="ilwd:char"/>
    <Column Name="segment_definergroup:segment_definer:segment_def_id" Type="ilwd:char"/>
    <Column Name="segment_definergroup:segment_definer:ifos" Type="lstring"/>
    <Column Name="segment_definergroup:segment_definer:name" Type="lstring"/>
    <Column Name="segment_definergroup:segment_definer:version" Type="int_4s"/>
    <Column Name="segment_definergroup:segment_definer:comment" Type="lstring"/>
    <Stream Name="segment_definergroup:segment_definer:table" Type="Local" Delimiter=",">
      "process:process_id:0","segment_definer:segment_def_id:35","H2","DMT-LIGHT",1,
      "H2 Light in arms from h(t) DQ flags",
      "process:process_id:0","segment_definer:segment_def_id:36","H2","DMT-SCIENCE",1,
      "H2 Science mode from h(t) DQ flags",
      "process:process_id:0","segment_definer:segment_def_id:37","H2","DMT-INJECTION",1,
      "H2 Injection mode from h(t) DQ flags",
      "process:process_id:0","segment_definer:segment_def_id:38","H2","DMT-UP",1,
      "H2 calibration OK in from h(t) DQ flags",
      "process:process_id:0","segment_definer:segment_def_id:39","H2","DMT-CALIBRATED",1,
      "H2 Calibration OK from h(t) DQ flags",
      "process:process_id:0","segment_definer:segment_def_id:40","H2","DMT-BADGAMMA",1,
      "H2 Bad gamma in h(t) DQ flags"
    </Stream>
  </Table>
  <Table Name="segmentgroup:segment:table">
    <Column Name="segmentgroup:segment:segment_id" Type="ilwd:char"/>
    <Column Name="segmentgroup:segment:start_time" Type="int_4s"/>
    <Column Name="segmentgroup:segment:end_time" Type="int_4s"/>
    <Column Name="segmentgroup:segment:segment_def_id" Type="ilwd:char"/>
    <Column Name="segmentgroup:segment:process_id" Type="ilwd:char"/>
    <Stream Name="segmentgroup:segment:table" Type="Local" Delimiter=",">
      "segment:segment_id:15",918836961,918836977,"segment_definer:segment_def_id:35",
      "process:process_id:0",
      "segment:segment_id:16",918836976,918836992,"segment_definer:segment_def_id:37",
      "process:process_id:0"
    </Stream>
  </Table>
  <Table Name="segment_summarygroup:segment_summary:table">
    <Column Name="segment_summarygroup:segment_summary:segment_sum_id" Type="ilwd:char"/>
    <Column Name="segment_summarygroup:segment_summary:start_time" Type="int_4s"/>
    <Column Name="segment_summarygroup:segment_summary:end_time" Type="int_4s"/>
    <Column Name="segment_summarygroup:segment_summary:comment" Type="lstring"/>
    <Column Name="segment_summarygroup:segment_summary:segment_def_id" Type="ilwd:char"/>
    <Column Name="segment_summarygroup:segment_summary:process_id" Type="ilwd:char"/>
    <Stream Name="segment_summarygroup:segment_summary:table" Type="Local" Delimiter=",">
      "segment_summary:segment_sum_id:5",918836976,918836992,"",
      "segment_definer:segment_def_id:40","process:process_id:0",
      "segment_summary:segment_sum_id:6",918836976,918836992,"",
      "segment_definer:segment_def_id:39","process:process_id:0",
      "segment_summary:segment_sum_id:11",918836976,918836992,"",
      "segment_definer:segment_def_id:37","process:process_id:0",
      "segment_summary:segment_sum_id:12",918836976,918836992,"",
      "segment_definer:segment_def_id:35","process:process_id:0",
      "segment_summary:segment_sum_id:42",918836976,918836992,"",
      "segment_definer:segment_def_id:36","process:process_id:0",
      "segment_summary:segment_sum_id:46",918836976,918836992,"",
      "segment_definer:segment_def_id:38","process:process_id:0"
    </Stream>
  </Table>
</LIGO_LW>
\end{verbatim}
}

\section{Converting XML to plain ASCII}
ligolw\_print can be used to convert XML file to plain ASCII format. ligolw\_print prints the contents of table elements from one or more LIGO Light Weight XML files to stdout in delimited ASCII format.  In addition to regular files, the
program can read from many common URLs such as http:// and ftp://.  Any filename or URL that ends in ".gz" is assumed to be gzip-compressed, and will be decompressed on input.  If no filenames or URLs are given, then input is read from stdin.


DESCRIPTION:
\begin{verbatim}
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -i name, --input-cache=name
                        Get URLs from the LAL cache file.  Can be provided
                        multiple times to name several caches to iterate over.
  -c name, --column=name
                        Print only the contents of the given column.  Can be
                        provided multiple times to print multiple columns.
                        The default is to print all columns from each table.
  -d string, --delimiter=string
                        Delimit output with the given string.  The default is
                        ",".
  -r rowspec, --rows=rowspec
                        Print rows in the given range(s).  The format is
                        first:last[,first:last,...].  Rows are numbered from
                        0.  A single first:last pair requests rows in the
                        range [first, last).  If the first or last value of a
                        pair is omited it means 0 or infinity respectively.
                        The default is ":", or to print all rows.
  -t name, --table=name
                        Print rows from this table.  Can be provided multiple
                        times to print rows from multiple tables.  The default
                        is to print the contents of all tables.
  -a name, --array=name
                        Print the contents of this array.  Can be provided
                        multiple times to print the elements from multiple
                        arrays.  The default is to print the contents of all
                        arrays.
  -v, --verbose         Be verbose.
  --constrain-lsc-tables
                        Impose additional constraints on official LSC tables.
                        Provides format validation and allows RAM requirements
                        to be reduced.
\end{verbatim}

